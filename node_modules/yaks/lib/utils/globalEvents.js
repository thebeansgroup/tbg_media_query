// Generated by CoffeeScript 1.9.1
(function() {
  var GlobalEvents, canUseDOM, pubsub;

  pubsub = require('./pubsub.js');

  canUseDOM = require('./canUseDOM.js');

  GlobalEvents = (function() {
    function GlobalEvents() {
      if (canUseDOM) {
        this.ready();
        this.resize();
        this.scroll();
      }
    }

    GlobalEvents.prototype.ready = function() {
      document.addEventListener("DOMContentLoaded", this._ready_completed.bind(this), false);
      return window.addEventListener("load", this._ready_completed.bind(this), false);
    };

    GlobalEvents.prototype._ready_completed = function() {
      pubsub.publish('load');
      document.removeEventListener("DOMContentLoaded", this._ready_completed.bind(this), false);
      return window.removeEventListener("load", this._ready_completed.bind(this), false);
    };

    GlobalEvents.prototype.resize = function() {
      this.resizeTimer = null;
      window.addEventListener('onresize', this._resize_handler.bind(this));
      return window.addEventListener('resize', this._resize_handler.bind(this));
    };

    GlobalEvents.prototype._resize_handler = function() {
      if (this.resizeTimer) {
        clearTimeout(this.resizeTimer);
      }
      return this.resizeTimer = setTimeout(this._resize_fire.bind(this), 400);
    };

    GlobalEvents.prototype._resize_fire = function() {
      return pubsub.publish('resize', this._resize_get_breakpoint_name());
    };

    GlobalEvents.prototype._resize_get_breakpoint_name = function() {
      if (window.getComputedStyle == null) {
        return '';
      }
      return window.getComputedStyle(document.body, ':after').getPropertyValue('content').replace('-', '') || '';
    };

    GlobalEvents.prototype.scroll = function() {
      this.scrollTimer = null;
      window.addEventListener('onscroll', this._scroll_handler.bind(this));
      return window.addEventListener('scroll', this._scroll_handler.bind(this));
    };

    GlobalEvents.prototype._scroll_handler = function() {
      if (this.scrollTimer) {
        clearTimeout(this.scrollTimer);
      }
      return this.scrollTimer = setTimeout(this._scroll_fire.bind(this), 200);
    };

    GlobalEvents.prototype._scroll_fire = function() {
      return pubsub.publish('scroll');
    };

    return GlobalEvents;

  })();

  module.exports = new GlobalEvents();

}).call(this);
