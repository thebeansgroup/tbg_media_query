// Generated by CoffeeScript 1.9.2
var MediaQuery, React, ResizeMonitor, Yaks, canUseDOM;

React = require('react');

Yaks = require('yaks');

ResizeMonitor = require('./resize');

canUseDOM = Yaks.UTILS.canUseDOM;

MediaQuery = {
  propTypes: {
    breakpoints: React.PropTypes.object.isRequired,
    component: React.PropTypes.string
  },
  getInitialState: function() {
    return {
      breakpoint: null
    };
  },
  getDefaultProps: function() {
    return {
      component: 'div',
      componentProps: {},
      defaultBreakpoint: 'mother',
      breakpoints: {}
    };
  },
  hasCurrentBreakpoint: function() {
    return this._getBreakpointRenderMethod() != null;
  },
  componentWillMount: function() {
    if (canUseDOM) {
      return this._onChange();
    }
  },
  componentDidMount: function() {
    this.componentMounted = true;
    return ResizeMonitor.addChangeListener(this._onChange);
  },
  componentWillUnmount: function() {
    this.componentMounted = false;
    return ResizeMonitor.removeChangeListener(this._onChange);
  },
  _getBreakpointFromBody: function() {
    if (window.getComputedStyle == null) {
      return '';
    }
    return window.getComputedStyle(document.body, ':after').getPropertyValue('content').replace('-', '').replace(/'/g, '').replace(/"/g, '') || '';
  },
  _getBreakpointRenderMethod: function() {
    return this.props.breakpoints[this.state.breakpoint || this.props.defaultBreakpoint];
  },
  _onChange: function() {
    if (this.componentMounted) {
      return this.setState({
        breakpoint: this._getBreakpointFromBody()
      });
    }
  },
  render: function() {
    if (!this.hasCurrentBreakpoint()) {
      return null;
    }
    return React.createElement(this.props.component, this.props.componentProps, this._getBreakpointRenderMethod());
  }
};

module.exports = React.createClass(MediaQuery);
